"""README.md generategenerator"""
from ..templates.base import BaseTemplateGenerator


class ReadmeGenerator(BaseTemplateGenerator):
    """README.md File generator"""
    
    def generate(self) -> None:
        """generate README.md file"""
        project_name = self.config_reader.get_project_name()
        
        content = self._build_header(project_name)
        content += self._build_features_section()
        content += self._build_installation_section()
        content += self._build_structure_section()
        content += self._build_configuration_section()
        content += self._build_api_docs_section()
        content += self._build_development_section()
        content += self._build_license_section()
        
        self.file_ops.create_markdown_file(
            file_path="README.md",
            title=None,
            content=content,
            overwrite=True
        )
    
    def _build_header(self, project_name: str) -> str:
        """Buildheader"""
        return f'''# {project_name}

FastAPI project generated by Forge.

'''
    
    def _build_features_section(self) -> str:
        """Buildfeatures list section"""
        features = []
        
        # database(is nowrequired)
        db_type = self.config_reader.get_database_type()
        orm_type = self.config_reader.get_orm_type()
        features.append(f"- ðŸ—„ï¸ Database: {db_type} with {orm_type}")
        
        if self.config_reader.has_auth():
            auth_type = self.config_reader.get_auth_type()
            features.append(f"- ðŸ” Authentication: {auth_type}")
            if self.config_reader.has_refresh_token():
                features.append("- ðŸ”„ Refresh Token support")
        
        if self.config_reader.has_cors():
            features.append("- ðŸŒ CORS enabled")
        
        if self.config_reader.has_testing():
            features.append("- ðŸ§ª Testing with pytest")
        
        if self.config_reader.has_docker():
            features.append("- ðŸ³ Docker support")
        
        if self.config_reader.has_dev_tools():
            features.append("- ðŸ› ï¸ Development tools (Black, Ruff, MyPy)")
        
        return '## Features\n\n' + '\n'.join(features) + '\n\n'
    
    def _build_installation_section(self) -> str:
        """Buildinstallation instructions section"""
        return '''## Installation

### Using uv (Recommended)

```bash
# Install dependencies
uv sync

# Run the application
uv run uvicorn app.main:app --reload
```

### Using pip

```bash
# Create virtual environment
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\\Scripts\\activate

# Install dependencies
pip install -e .

# Run the application
uvicorn app.main:app --reload
```

'''
    
    def _build_structure_section(self) -> str:
        """Buildprojectstructure section"""
        content = '''## Project Structure

```
.
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/           # Core configurations
â”‚   â”œâ”€â”€ router/         # API routes
â”‚   â”œâ”€â”€ schemas/        # Pydantic schemas
â”‚   â”œâ”€â”€ utils/          # Utility functions
â”‚   â”œâ”€â”€ models/         # Database models
â”‚   â”œâ”€â”€ crud/           # CRUD operations
'''
        
        if self.config_reader.has_auth():
            content += '''â”‚   â”œâ”€â”€ services/       # Business logic
'''
        
        content += '''â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ main.py             # Application entry point
'''
        
        if self.config_reader.has_testing():
            content += '''â”œâ”€â”€ tests/              # Test files
'''
        
        content += '''â”œâ”€â”€ .env.example        # Environment variables example
â”œâ”€â”€ pyproject.toml      # Project dependencies
â””â”€â”€ README.md           # This file
```

'''
        return content
    
    def _build_configuration_section(self) -> str:
        """Buildconfigurationdescriptionpartial"""
        content = '''## Configuration

Copy `.env.example` to `.env` and update the values:

```bash
cp .env.example .env
```

'''
        # databaseconfiguration(is nowrequired)
        content += self._build_database_config()
        
        return content
    
    def _build_database_config(self) -> str:
        """Builddatabaseconfigurationdescription"""
        content = '''### Database Configuration

Update the database connection string in `.env`:

```
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
```

'''
        
        if self.config_reader.has_migration():
            content += '''### Database Migrations

```bash
# Create a new migration
alembic revision --autogenerate -m "description"

# Apply migrations
alembic upgrade head
```

'''
        
        return content
    
    def _build_api_docs_section(self) -> str:
        """Build API documentationpartial"""
        return '''## API Documentation

Once the application is running, visit:

- Swagger UI: http://127.0.0.1:8000/docs
- ReDoc: http://127.0.0.1:8000/redoc

'''
    
    def _build_development_section(self) -> str:
        """Build development section"""
        content = '## Development\n\n'
        
        if self.config_reader.has_dev_tools():
            content += self._build_dev_tools_section()
        
        if self.config_reader.has_testing():
            content += self._build_testing_section()
        
        if self.config_reader.has_docker():
            content += self._build_docker_section()
        
        return content
    
    def _build_dev_tools_section(self) -> str:
        """Build development tools section"""
        return '''### Code Formatting

```bash
# Format code with Black
black .

# Lint with Ruff
ruff check .

# Type checking with MyPy
mypy .
```

'''
    
    def _build_testing_section(self) -> str:
        """Buildtestdescription"""
        return '''### Running Tests

```bash
# Run all tests
pytest

# Run with coverage
pytest --cov=app tests/
```

'''
    
    def _build_docker_section(self) -> str:
        """Build Docker description"""
        project_name = self.config_reader.get_project_name()
        return f'''### Docker

```bash
# Build image
docker build -t {project_name} .

# Run container
docker run -p 8000:8000 {project_name}
```

'''
    
    def _build_license_section(self) -> str:
        """Build license section"""
        return '''## License

MIT
'''
